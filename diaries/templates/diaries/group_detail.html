{% extends 'base.html' %}
{% load static %}

{% block css %}<link rel="stylesheet" href="{% static 'css/diary.css' %}">{% endblock css %}

{% block title %}JELLY | {{ diary.title }}{% endblock title %}

{% block side %}
  {% include 'sidebar.html' %}
{% endblock side %}

{% block content %}
<div class="wrapper">  
  <section class="header justify-between">
    <div class="flex gap-2">
      <a href="{% url 'diaries:index' %}" class="diary main-btn">ëª©ë¡</a>
      <a href="{% url 'diaries:index' %}" class="diary main-btn">ì´ì „ê¸€</a>
      <a href="{% url 'diaries:index' %}" class="diary main-btn">ë‹¤ìŒê¸€</a>
    </div>
  </section>
  
  <section class="content">
    <div class="flex justify-between items-end px-2">
      <div>
        <h2 class="title">{{ diary.title }}</h2>
        <p class="date">{{ diary.created_at }}</p>
      </div>
      <div class="flex gap-4">
        {% if request.user == diary.user %}
          <form action="{% url 'diaries:unshare' group.pk diary.pk %}">
            {% csrf_token %}
            <input type="submit" value="ê³µìœ ì·¨ì†Œ" class="diary" onclick="return confirm('í•´ë‹¹ ê²Œì‹œê¸€ì— í¬í•¨ëœ ëŒ“ê¸€ë„ í•¨ê»˜ ì‚­ì œë©ë‹ˆë‹¤.\nê³µìœ ë¥¼ ì·¨ì†Œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?')">
          </form>
        {% endif %}
        <a href="{% url 'diaries:update' diary.pk %}" class="diary">ìˆ˜ì •</a>
        <a href="{% url 'diaries:delete' diary.pk %}" class="diary delete" onclick="return confirm('ì •ë§ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?')">ì‚­ì œ</a>
      </div>
           
    </div>
    <hr class="diary-hr">
    <div class="ck-content diary-detail">
      {{ diary.content|safe }}
    </div>
    <div class="relative">
      <a href="#" class="top-btn">
        <svg style="color: rgb(0, 0, 0);" xmlns="http://www.w3.org/2000/svg" width="6" height="6" fill="currentColor" class="bi bi-triangle-fill" viewBox="0 0 16 16"> <path fill-rule="evenodd" d="M7.022 1.566a1.13 1.13 0 0 1 1.96 0l6.857 11.667c.457.778-.092 1.767-.98 1.767H1.144c-.889 0-1.437-.99-.98-1.767L7.022 1.566z" fill="#000000"></path> </svg>
        TOP
      </a>
    </div>
    </section>
     {% comment %} 1:ğŸ‘ 2:ğŸ¥° 3:ğŸ¤£ 4:ğŸ˜² 5:ğŸ˜­ 6:ğŸ¥³ {% endcomment %}
    <div class="content bottom">
      <section class="reaction">
        <div>
          <button id="dropdownRightButton" data-dropdown-toggle="dropdownRight" data-dropdown-placement="right" class="diary reaction-count" type="button">
            <svg xmlns="http://www.w3.org/2000/svg" fill="#FACA1590" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-5 h-5">
              <path stroke-linecap="round" stroke-linejoin="round" d="M15.182 15.182a4.5 4.5 0 01-6.364 0M21 12a9 9 0 11-18 0 9 9 0 0118 0zM9.75 9.75c0 .414-.168.75-.375.75S9 10.164 9 9.75 9.168 9 9.375 9s.375.336.375.75zm-.375 0h.008v.015h-.008V9.75zm5.625 0c0 .414-.168.75-.375.75s-.375-.336-.375-.75.168-.75.375-.75.375.336.375.75zm-.375 0h.008v.015h-.008V9.75z" />
            </svg>            
            <p>{{ diary_share.diaryemote_set.all|length }}</p>
          </button>
          {% comment %} ê°ì •í‘œí˜„ ë“œëë‹¤ìš´ ë©”ë‰´ {% endcomment %}
          <div id="dropdownRight" class="z-10 hidden bg-white divide-y divide-gray-100 rounded-lg shadow">
            <ul class="emotion-group" aria-labelledby="dropdownDefaultButton">
              {% for emotion in emotions %}
                <li class="emotion {% if emotion.exist %}selected-emotion{% endif %}">
                  {% if request.user.is_authenticated %}
                    {{ emotion.queryset }}
                    <form action="{% url 'diaries:emotes' group.pk diary.pk emotion.value %}" method="POST">
                      {% csrf_token %}
                      <button class="emotion-btn">
                        {% if emotion.value == 1 %}
                          <span class="emotion-emoji">ğŸ‘</span>
                        {% elif emotion.value == 2 %}
                          <span class="emotion-emoji">ğŸ¥°</span>
                        {% elif emotion.value == 3 %}
                          <span class="emotion-emoji">ğŸ¤£</span>
                        {% elif emotion.value == 4 %}
                          <span class="emotion-emoji">ğŸ˜²</span>
                        {% elif emotion.value == 5 %}
                          <span class="emotion-emoji">ğŸ˜­</span>
                        {% else %}
                          <span class="emotion-emoji">ğŸ¥³</span>
                        {% endif %}
                        <span>{{emotion.label}}</span>
                      </button>
                    </form>
                  {% else %}
                  {% endif %}
                  <p>{{ emotion.count }}</p>
                </li>
              {% endfor %}
            </ul>
          </div>
        </div>
        <div class="reaction-count">
          <span>ëŒ“ê¸€</span>
          <span>{{ comments|length }}</span>
        </div>
      </section>
  
      <section>
        <div>
          {% comment %} ëŒ“ê¸€ ì‘ì„± ì¹¸ {% endcomment %}
          <form action="{% url 'diaries:comment_create' group.pk diary.pk %}" method="POST" class="comment-form">
            {% csrf_token %}
            {{ comment_form }}
            <input type="submit" value="ì‘ì„±" class="comment main-btn">
          </form>
        </div>
        {% comment %} ëŒ“ê¸€ ë¦¬ìŠ¤íŠ¸ {% endcomment %}
        <div class="comment-wrapper">
          {% for comment in comments %}
            <div class="comment-area">
              <div class="user-img image">
                {% comment %} <img src="" alt=""> {% endcomment %}
              </div>
              <div class="comment-content">
                <p class="comment-user">{{ comment.user }}</p>
                <p class="comment-comment">{{ comment.comment }}</p>
                <div class="date comment-bottom">
                  <div class="comment-bottom-item">
                    <p>{{ comment.created_at }}</p>
                    {% comment %} ëŒ“ê¸€ ì¢‹ì•„ìš” {% endcomment %}
                    {% comment %} <form class="comment-like-forms" action="{% url 'diaries:comment_like' group.pk diary.pk comment.pk %}" method="POST" data-comment-id="{{ comment.pk }}" data-group-id="{{ group.pk }}" data-diary-id="{{ diary.pk }}"> {% endcomment %}
                    <form class="comment-like-forms" data-comment-id="{{ comment.pk }}" data-group-id="{{ group.pk }}" data-diary-id="{{ diary.pk }}">
                      {% csrf_token %}
                      <button type="submit" class="comment-like-btn" id="comment-like-btn-{{ comment.pk }}">
                        <svg xmlns="http://www.w3.org/2000/svg" fill="{% if request.user in comment.like_users.all %}#E02424{% else %}none{% endif %}" viewBox="0 0 24 24" stroke-width="1.5" stroke="#E02424" class="w-4 h-4">
                          <path stroke-linecap="round" stroke-linejoin="round" d="M21 8.25c0-2.485-2.099-4.5-4.688-4.5-1.935 0-3.597 1.126-4.312 2.733-.715-1.607-2.377-2.733-4.313-2.733C5.1 3.75 3 5.765 3 8.25c0 7.22 9 12 9 12s9-4.78 9-12z" />
                        </svg>
                        <span>{{ comment.like_users.count }}</span>
                      </button>
                    </form>
                  </div>
                  <div class="comment-bottom-item">
                    {% if comment.user == request.user %}
                      {% comment %} ëŒ“ê¸€ ìˆ˜ì • ë¹„ë™ê¸° í•„ìš” {% endcomment %}
                      <form action="{% url 'diaries:comment_update' group.pk diary.pk comment.pk %}" method="POST">
                        {% csrf_token %}
                        <input type="submit" value="ëŒ“ê¸€ìˆ˜ì •">
                      </form>
                      <form action="{% url 'diaries:comment_delete' group.pk diary.pk comment.pk %}" method="POST">
                        {% csrf_token %}
                        <input type="submit" value="ëŒ“ê¸€ì‚­ì œ" class="delete">
                      </form>
                    {% endif %}
                  </div>
                </div>
              </div>
            </div>
            <hr class="comment-hr">
          {% endfor %}
        </div>
      </section>
    </div>
</div>
{% endblock content %}

{% block script %}
<script src="{% static 'js/diary_group.js' %}"></script>
{% endblock script %}