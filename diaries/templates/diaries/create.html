{% extends 'base.html' %}
{% load static %}

{% block title %}JELLY | 글 작성{% endblock title %}

{% block css %}
{% comment %} <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-9ndCyUaIbzAi2FUVXJi0CjmCapSmO7SnpJef0486qhLnuZ2cdeRhO02iuK6FUUVM" crossorigin="anonymous"> {% endcomment %}
<link rel="stylesheet" href="{% static 'css/diary_create.css' %}">
{% endblock css %}

{% block side %}
  {% include 'sidebar.html' %}
{% endblock side %}


{% block content %}
<div class="wrapper">
  <form action="{% block url %}{% url 'diaries:create' %}{% endblock url %}" method="POST" enctype="multipart/form-data">
    {% csrf_token %}
    {{ form.media }}
    {% for field in form %}
    <div>
      {{ field.label_tag }}
      {{ field }}
    </div>
    {% endfor %}
    <div class="btns">
      <a href="{% url 'diaries:index' %}" class="main-btn back" onclick="return confirm('글쓰기를 종료하시겠습니까?\n작성 중인 글은 저장되지 않습니다. ')">취소</a>
      <input type="submit" value="작성" class="main-btn bg-[var(--color-main)]">
    </div>
  </form>
  <button id="select-thumbnail-btn">썸네일 선택하기</button>
</div>
{% endblock content %}

{% block script %}
<script src="https://cdn.jsdelivr.net/npm/jquery@3.5.1/dist/jquery.slim.min.js" integrity="sha384-DfXdz2htPH0lsSSs5nCTpuj/zy4C+OGpamoFVy38MVBnE+IbbVYUew+OrCXaRkfj" crossorigin="anonymous"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@4.6.2/dist/js/bootstrap.bundle.min.js" integrity="sha384-Fy6S3B9q64WdZWQUiU+q4/2Lc9npb8tCaSX9FK7E8HnRr0Jz8D6OP9dO5Vg3Q9ct" crossorigin="anonymous"></script>
<script>
  const selectThumbnailBtn = document.getElementById('select-thumbnail-btn')
  const thumbnailInput = document.getElementById('thumbnail_input')
  let images = null
  let selectedImage = null

  // '썸네일 선택하기' 버튼 클릭 시 이미지 선택 기능 활성화
  selectThumbnailBtn.addEventListener('click', function() {
    images = document.querySelectorAll('.ck-editor__main img')
    // 이미지 클릭 이벤트 핸들러 등록
    for (var i = 0; i < images.length; i++) {
      images[i].addEventListener('click', selectImageOnce)
    }
  })
  // 이미지 클릭 시 선택 처리
  function selectImageOnce() {
    if (selectedImage) {
      selectedImage.removeAttribute('id')
    }
    this.id = 'thumbnail'
    selectedImage = this
    thumbnailInput.setAttribute('value', `${this.src}`)

    for (var i = 0; i < images.length; i++) {
      images[i].removeEventListener('click', selectImageOnce)
    }
  }

</script>
{% endblock script %}