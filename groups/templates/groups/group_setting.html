{% extends 'base.html' %}
{% load static %}

{% block title %}{{ group }}{% endblock title %}
{% block css %}
<link rel="stylesheet" href="{% static 'css/group_setting.css' %}">
{% endblock css %}

{% block side %}
  {% include 'sidebar.html' with current_group=group %}
{% endblock side %} 

{% block content %}

  <div>
    <button data-modal-target="group-password-update-modal" data-modal-toggle="group-password-update-modal" class="block text-white bg-blue-700 hover:bg-blue-800 focus:ring-4 focus:outline-none focus:ring-blue-300 font-medium rounded-lg text-sm px-5 py-2.5 text-center dark:bg-blue-600 dark:hover:bg-blue-700 dark:focus:ring-blue-800" type="button">
      암호 변경
    </button>
  </div>


<div class="wrapper">
  <div class="content">
    <!-- 그룹 정보 -->
    <h3 class="title">그룹 정보</h3>
    {% comment %} <div>
      <div>
        <h3>{{ group }}</h3>
      </div>
      <div>
        <p>{{ group.intro }}</p>
      </div>
    </div> {% endcomment %}
    <!-- 그룹 정보 수정, 삭제 버튼 -->

    <div>
      {% comment %} <button data-modal-target="group-info-update-modal" data-modal-toggle="group-info-update-modal" class="main-btn block">정보 수정</button> {% endcomment %}
      <form class="space-y-6" action="{% url 'groups:group_update' group.pk %}" method="POST" enctype="multipart/form-data">
        {% csrf_token %}
        <div class="group-update">
          <p>{{ form.name.label }}</p>
          <div class="update-form">
            {{ form.name}}
          </div>
        </div>
        <div class="group-update file">
          <p>{{ form.thumbnail.label }}</p>
          <div class="flex flex-col">
            <div class="image group-img">
              <img src={{ group.thumbnail.url }} alt="그룹 이미지">
            </div>
            <div class="update-form">
              {{ form.thumbnail}}
            </div>
          </div>
        </div>
        <div class="group-update">
          <p>{{ form.intro.label }}</p>
          <div class="update-form">
            {{ form.intro}}
          </div>
        </div>
        <input type="submit" value="저장" class="main-btn bg-[var(--color-main)]">
      </form>
    </div>
    <hr class="my-6">
    <!-- 그룹 멤버 삭제, 방장 위임 -->
    <h3 class="title">멤버 정보</h3>
    <ul class="user-list">
      {% for member in group.group_users.all %}
        <li class="user">
          <div class="user-img image">
            {% if member.image %}
              <img src="{{ member.image.url }}" alt="멤버 프로필 사진">
            {% else %}
              <img src="{% static 'img/blank_profile_img.png' %}" alt="멤버 프로필 사진">
            {% endif %}
          </div>
          <p>{{ member.nickname }}</p>
          {% if member != request.user %}
            <div>
              <form action="{% url 'groups:member_delete' group.pk member.username %}" method="POST">
                {% csrf_token %}
                <input type="submit" value="멤버 삭제">
              </form>
              <form action="{% url 'groups:chief_change' group.pk member.username %}" method="POST">
                {% csrf_token %}
                <input type="submit" value="방장 위임">
              </form>
            </div>
          {% endif %}
        </li>
      {% endfor %}
    </ul>
    <a href="{% url 'groups:group_delete' group.pk %}" class="main-btn delete" onclick="return confirm('삭제한 그룹은 복구할 수 없습니다.\n정말 삭제하시겠습니까?')">그룹 삭제</a>
  </div>
</div>


<!-- 그룹 암호변경 modal -->
<div id="group-password-update-modal" tabindex="-1" aria-hidden="true" class="fixed top-0 left-0 right-0 z-50 hidden w-full p-4 overflow-x-hidden overflow-y-auto md:inset-0 h-[calc(100%-1rem)] max-h-full">
  <div class="relative w-full max-w-md max-h-full">
    <!-- Modal content -->
    <div class="relative bg-white rounded-lg shadow dark:bg-gray-700">
      <button type="button" class="absolute top-3 right-2.5 text-gray-400 bg-transparent hover:bg-gray-200 hover:text-gray-900 rounded-lg text-sm p-1.5 ml-auto inline-flex items-center dark:hover:bg-gray-800 dark:hover:text-white" data-modal-hide="group-password-update-modal">
        <svg aria-hidden="true" class="w-5 h-5" fill="currentColor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" d="M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z" clip-rule="evenodd"></path></svg>
        <span class="sr-only">Close modal</span>
      </button>
      <div class="px-6 py-6 lg:px-8">
        <h3 class="mb-4 text-xl font-medium text-gray-900 dark:text-white">그룹 암호 변경</h3>
        <form class="space-y-6" action="{% url 'groups:password_update' group.pk %}" method="POST">
          {% csrf_token %}
          <label for="old-password">기존 암호</label>
          <input type="password" id="old-password" name="old-password">
          <label for="new-password1">새 암호</label>
          <input type="password" id="new-password1" name="new-password1">
          <label for="new-password2">새 암호 확인</label>
          <input type="password" id="new-password2" name="new-password2">
          <button type="submit" class="w-full text-white bg-blue-700 hover:bg-blue-800 focus:ring-4 focus:outline-none focus:ring-blue-300 font-medium rounded-lg text-sm px-5 py-2.5 text-center dark:bg-blue-600 dark:hover:bg-blue-700 dark:focus:ring-blue-800">변경</button>
        </form>
      </div>
    </div>
  </div>
</div>

<!-- password 변경 실패 시 alert -->
{% if messages %}
  {% for message in messages %}
    <script>alert('{{ message }}')</script>
  {% endfor %}
{% endif %}

{% endblock content %}